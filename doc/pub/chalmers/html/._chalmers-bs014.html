<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Solving Quantum Mechanical Many-body Problems with Machine Learning Algorithms">

<title>Solving Quantum Mechanical Many-body Problems with Machine Learning Algorithms</title>

<!-- Bootstrap style: bootstrap -->
<link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:50px;      /* fixed header height for style bootstrap */
  margin:-50px 0 0; /* negative fixed header height */
}
</style>


</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [('What is this talk about?', 2, None, '___sec0'),
              ('More material', 2, None, '___sec1'),
              ('Why? Basic motivation', 2, None, '___sec2'),
              ('Overview', 2, None, '___sec3'),
              ('What is Machine Learning?', 2, None, '___sec4'),
              ('What are the Machine Learning calculations here based on?',
               2,
               None,
               '___sec5'),
              ('A new world', 2, None, '___sec6'),
              ('Lots of room for creativity', 2, None, '___sec7'),
              ('Knowledge of Statistical analysis and optimization of data',
               2,
               None,
               '___sec8'),
              ('Some members of the ML family', 2, None, '___sec9'),
              ('What are the basic ingredients?', 2, None, '___sec10'),
              ('Types of Machine Learning', 2, None, '___sec11'),
              ('References', 2, None, '___sec12'),
              ('Fitting Nuclear Masses', 2, None, '___sec13'),
              ('Organizing our data', 3, None, '___sec14'),
              ('Artificial neurons', 2, None, '___sec15'),
              ('A simple perceptron model', 2, None, '___sec16'),
              ('Neural network types', 2, None, '___sec17'),
              ('The system: two electrons in a harmonic oscillator trap in two '
               'dimensions',
               2,
               None,
               '___sec18'),
              ('Quantum Monte Carlo Motivation', 2, None, '___sec19'),
              ('Quantum Monte Carlo Motivation', 2, None, '___sec20'),
              ('Quantum Monte Carlo Motivation', 2, None, '___sec21'),
              ('Quantum Monte Carlo', 2, None, '___sec22'),
              ('The trial wave function', 2, None, '___sec23'),
              ('The correlation part of the wave function',
               2,
               None,
               '___sec24'),
              ('Resulting ansatz', 2, None, '___sec25'),
              ('The VMC code', 2, None, '___sec26'),
              ('Technical aspect, improvements and how to define the cost '
               'function',
               2,
               None,
               '___sec27'),
              ('Energy derivatives', 2, None, '___sec28'),
              ('Derivatives of the local energy', 2, None, '___sec29'),
              ('How do we define our cost function?', 2, None, '___sec30'),
              ('Meet the variance and its derivatives', 2, None, '___sec31'),
              ('The variance defines the cost function', 2, None, '___sec32'),
              ('The code for two electrons in two dims with no Coulomb '
               'interaction',
               2,
               None,
               '___sec33'),
              ('Why Boltzmann machines?', 2, None, '___sec34'),
              ('Boltzmann Machines', 2, None, '___sec35'),
              ('Some similarities and differences from DNNs',
               2,
               None,
               '___sec36'),
              ('Boltzmann machines (BM)', 2, None, '___sec37'),
              ('A standard BM setup', 2, None, '___sec38'),
              ('The structure of the RBM network', 2, None, '___sec39'),
              ('The network', 2, None, '___sec40'),
              ('Goals', 2, None, '___sec41'),
              ('Joint distribution', 2, None, '___sec42'),
              ('Network Elements, the energy function', 2, None, '___sec43'),
              ('Defining different types of RBMs', 2, None, '___sec44'),
              ('Sampling: Metropolis sampling', 2, None, '___sec45'),
              ('RBMs for the quantum many body problem', 2, None, '___sec46'),
              ('Choose the right RBM', 2, None, '___sec47'),
              ('Representing the wave function', 2, None, '___sec48'),
              ('Choose the cost/loss function', 2, None, '___sec49'),
              ('Running the codes', 2, None, '___sec50'),
              ('Energy as function of iterations, $N=2$ electrons',
               2,
               None,
               '___sec51'),
              ('Energy as function of iterations, no Physics info $N=2$ '
               'electrons',
               2,
               None,
               '___sec52'),
              ('Energy as function of iterations, $N=6$ electrons',
               2,
               None,
               '___sec53'),
              ('Wave function analysis, onebody densities $N=2$',
               2,
               None,
               '___sec54'),
              ('Wave function analysis, onebody densities $N=6$',
               2,
               None,
               '___sec55'),
              ('Wave function analysis, onebody densities $N=12$',
               2,
               None,
               '___sec56'),
              ('Conclusions and where do we stand', 2, None, '___sec57'),
              ('Appendix: Mathematical details', 2, None, '___sec58'),
              ('Marginal Probability Density Functions', 3, None, '___sec59'),
              ('Conditional Probability Density Functions',
               3,
               None,
               '___sec60'),
              ('Python version for the two non-interacting particles',
               2,
               None,
               '___sec61')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="chalmers-bs.html">Solving Quantum Mechanical Many-body Problems with Machine Learning Algorithms</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._chalmers-bs001.html#___sec0" style="font-size: 80%;"><b>What is this talk about?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs002.html#___sec1" style="font-size: 80%;"><b>More material</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs003.html#___sec2" style="font-size: 80%;"><b>Why? Basic motivation</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs004.html#___sec3" style="font-size: 80%;"><b>Overview</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs005.html#___sec4" style="font-size: 80%;"><b>What is Machine Learning?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs006.html#___sec5" style="font-size: 80%;"><b>What are the Machine Learning calculations here based on?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs007.html#___sec6" style="font-size: 80%;"><b>A new world</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs008.html#___sec7" style="font-size: 80%;"><b>Lots of room for creativity</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs009.html#___sec8" style="font-size: 80%;"><b>Knowledge of Statistical analysis and optimization of data</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs010.html#___sec9" style="font-size: 80%;"><b>Some members of the ML family</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs011.html#___sec10" style="font-size: 80%;"><b>What are the basic ingredients?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs012.html#___sec11" style="font-size: 80%;"><b>Types of Machine Learning</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs013.html#___sec12" style="font-size: 80%;"><b>References</b></a></li>
     <!-- navigation toc: --> <li><a href="#___sec13" style="font-size: 80%;"><b>Fitting Nuclear Masses</b></a></li>
     <!-- navigation toc: --> <li><a href="#___sec14" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Organizing our data</a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs015.html#___sec15" style="font-size: 80%;"><b>Artificial neurons</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs016.html#___sec16" style="font-size: 80%;"><b>A simple perceptron model</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs017.html#___sec17" style="font-size: 80%;"><b>Neural network types</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs018.html#___sec18" style="font-size: 80%;"><b>The system: two electrons in a harmonic oscillator trap in two dimensions</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs019.html#___sec19" style="font-size: 80%;"><b>Quantum Monte Carlo Motivation</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs020.html#___sec20" style="font-size: 80%;"><b>Quantum Monte Carlo Motivation</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs021.html#___sec21" style="font-size: 80%;"><b>Quantum Monte Carlo Motivation</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs022.html#___sec22" style="font-size: 80%;"><b>Quantum Monte Carlo</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs023.html#___sec23" style="font-size: 80%;"><b>The trial wave function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs024.html#___sec24" style="font-size: 80%;"><b>The correlation part of the wave function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs025.html#___sec25" style="font-size: 80%;"><b>Resulting ansatz</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs026.html#___sec26" style="font-size: 80%;"><b>The VMC code</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs027.html#___sec27" style="font-size: 80%;"><b>Technical aspect, improvements and how to define the cost function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs028.html#___sec28" style="font-size: 80%;"><b>Energy derivatives</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs029.html#___sec29" style="font-size: 80%;"><b>Derivatives of the local energy</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs030.html#___sec30" style="font-size: 80%;"><b>How do we define our cost function?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs031.html#___sec31" style="font-size: 80%;"><b>Meet the variance and its derivatives</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs032.html#___sec32" style="font-size: 80%;"><b>The variance defines the cost function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs033.html#___sec33" style="font-size: 80%;"><b>The code for two electrons in two dims with no Coulomb interaction</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs034.html#___sec34" style="font-size: 80%;"><b>Why Boltzmann machines?</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs035.html#___sec35" style="font-size: 80%;"><b>Boltzmann Machines</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs036.html#___sec36" style="font-size: 80%;"><b>Some similarities and differences from DNNs</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs037.html#___sec37" style="font-size: 80%;"><b>Boltzmann machines (BM)</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs038.html#___sec38" style="font-size: 80%;"><b>A standard BM setup</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs039.html#___sec39" style="font-size: 80%;"><b>The structure of the RBM network</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs040.html#___sec40" style="font-size: 80%;"><b>The network</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs041.html#___sec41" style="font-size: 80%;"><b>Goals</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs042.html#___sec42" style="font-size: 80%;"><b>Joint distribution</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs043.html#___sec43" style="font-size: 80%;"><b>Network Elements, the energy function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs044.html#___sec44" style="font-size: 80%;"><b>Defining different types of RBMs</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs045.html#___sec45" style="font-size: 80%;"><b>Sampling: Metropolis sampling</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs046.html#___sec46" style="font-size: 80%;"><b>RBMs for the quantum many body problem</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs047.html#___sec47" style="font-size: 80%;"><b>Choose the right RBM</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs048.html#___sec48" style="font-size: 80%;"><b>Representing the wave function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs049.html#___sec49" style="font-size: 80%;"><b>Choose the cost/loss function</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs050.html#___sec50" style="font-size: 80%;"><b>Running the codes</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs051.html#___sec51" style="font-size: 80%;"><b>Energy as function of iterations, \( N=2 \) electrons</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs052.html#___sec52" style="font-size: 80%;"><b>Energy as function of iterations, no Physics info \( N=2 \) electrons</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs053.html#___sec53" style="font-size: 80%;"><b>Energy as function of iterations, \( N=6 \) electrons</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs054.html#___sec54" style="font-size: 80%;"><b>Wave function analysis, onebody densities \( N=2 \)</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs055.html#___sec55" style="font-size: 80%;"><b>Wave function analysis, onebody densities \( N=6 \)</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs056.html#___sec56" style="font-size: 80%;"><b>Wave function analysis, onebody densities \( N=12 \)</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs057.html#___sec57" style="font-size: 80%;"><b>Conclusions and where do we stand</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs058.html#___sec58" style="font-size: 80%;"><b>Appendix: Mathematical details</b></a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs058.html#___sec59" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Marginal Probability Density Functions</a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs058.html#___sec60" style="font-size: 80%;">&nbsp;&nbsp;&nbsp;Conditional Probability Density Functions</a></li>
     <!-- navigation toc: --> <li><a href="._chalmers-bs059.html#___sec61" style="font-size: 80%;"><b>Python version for the two non-interacting particles</b></a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0014"></a>
<!-- !split -->

<h2 id="___sec13" class="anchor">Fitting Nuclear Masses  </h2>

<p>
Let us now dive into  nuclear physics and remind ourselves briefly about some basic features about binding
energies.  A basic quantity which can be measured for the ground
states of nuclei is the atomic mass \( M(N, Z) \) of the neutral atom with
atomic mass number \( A \) and charge \( Z \). The number of neutrons is \( N \). There are indeed several sophisticated experiments worldwide which allow us to measure this quantity to high precision (parts per million even).

<p>
Atomic masses are usually tabulated in terms of the mass excess defined by
$$
\Delta M(N, Z) =  M(N, Z) - uA,
$$

where \( u \) is the Atomic Mass Unit 
$$
u = M(^{12}\mathrm{C})/12 = 931.4940954(57) \hspace{0.1cm} \mathrm{MeV}/c^2.
$$

<p>
In the <a href="http://nuclearmasses.org/resources_folder/Wang_2017_Chinese_Phys_C_41_030003.pdf" target="_self">2016 mass evaluation of by W.J.Huang, G.Audi, M.Wang, F.G.Kondev, S.Naimi and X.Xu</a>
there are data on masses and decays of 3437 nuclei.

<p>
The nuclear binding energy is defined as the energy required to break
up a given nucleus into its constituent parts of \( N \) neutrons and \( Z \)
protons. In terms of the atomic masses \( M(N, Z) \) the binding energy is
defined by

$$
BE(N, Z) = ZM_H c^2 + Nm_n c^2 - M(N, Z)c^2 ,
$$

where \( M_H \) is the mass of the hydrogen atom and \( m_n \) is the mass of the neutron.
In terms of the mass excess the binding energy is given by
$$
BE(N, Z) = Z\Delta_H c^2 + N\Delta_n c^2 -\Delta(N, Z)c^2 ,
$$

where \( \Delta_H c^2 = 7.2890 \) MeV and \( \Delta_n c^2 = 8.0713 \) MeV.

<p>
A popular and physically intuitive model which can be used to parametrize 
the experimental binding energies as function of \( A \), is the so-called 
<b>liquid drop model</b>. The ansatz is based on the following expression

$$ 
BE(N,Z) = a_1A-a_2A^{2/3}-a_3\frac{Z^2}{A^{1/3}}-a_4\frac{(N-Z)^2}{A},
$$

<p>
where \( A \) stands for the number of nucleons and the $a_i$s are parameters which are determined by a fit 
to the experimental data.

<h3 id="___sec14" class="anchor">Organizing our data </h3>

<p>
Let us start with reading and organizing our data. 
We start with the compilation of masses and binding energies from 2016.
After having downloaded this file to our own computer, we are now ready to read the file and start structuring our data.

<p>
We start with preparing folders for storing our calculations and the data file over masses and binding energies. We import also various modules that we will find useful in order to present various Machine Learning methods. Here we focus mainly on the functionality of <b>scikit-learn</b>.
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Common imports</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pandas</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">pd</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sklearn.linear_model</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">skl</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sklearn.model_selection</span> <span style="color: #008000; font-weight: bold">import</span> train_test_split
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sklearn.metrics</span> <span style="color: #008000; font-weight: bold">import</span> mean_squared_error, r2_score, mean_absolute_error
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">os</span>

<span style="color: #408080; font-style: italic"># Where to save the figures and data files</span>
PROJECT_ROOT_DIR <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Results&quot;</span>
FIGURE_ID <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Results/FigureFiles&quot;</span>
DATA_ID <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;DataFiles/&quot;</span>

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>exists(PROJECT_ROOT_DIR):
    os<span style="color: #666666">.</span>mkdir(PROJECT_ROOT_DIR)

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>exists(FIGURE_ID):
    os<span style="color: #666666">.</span>makedirs(FIGURE_ID)

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>exists(DATA_ID):
    os<span style="color: #666666">.</span>makedirs(DATA_ID)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">image_path</span>(fig_id):
    <span style="color: #008000; font-weight: bold">return</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(FIGURE_ID, fig_id)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">data_path</span>(dat_id):
    <span style="color: #008000; font-weight: bold">return</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(DATA_ID, dat_id)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">save_fig</span>(fig_id):
    plt<span style="color: #666666">.</span>savefig(image_path(fig_id) <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;.png&quot;</span>, format<span style="color: #666666">=</span><span style="color: #BA2121">&#39;png&#39;</span>)

infile <span style="color: #666666">=</span> <span style="color: #008000">open</span>(data_path(<span style="color: #BA2121">&quot;MassEval2016.dat&quot;</span>),<span style="color: #BA2121">&#39;r&#39;</span>)
</pre></div>
<p>
Before we proceed, we define also a function for making our plots. You can obviously avoid this and simply set up various <b>matplotlib</b> commands every time you need them. You may however find it convenient to collect all such commands in one function and simply call this function. 
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">pylab</span> <span style="color: #008000; font-weight: bold">import</span> plt, mpl
plt<span style="color: #666666">.</span>style<span style="color: #666666">.</span>use(<span style="color: #BA2121">&#39;seaborn&#39;</span>)
mpl<span style="color: #666666">.</span>rcParams[<span style="color: #BA2121">&#39;font.family&#39;</span>] <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;serif&#39;</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">MakePlot</span>(x,y, styles, labels, axlabels):
    plt<span style="color: #666666">.</span>figure(figsize<span style="color: #666666">=</span>(<span style="color: #666666">10</span>,<span style="color: #666666">6</span>))
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(x)):
        plt<span style="color: #666666">.</span>plot(x[i], y[i], styles[i], label <span style="color: #666666">=</span> labels[i])
        plt<span style="color: #666666">.</span>xlabel(axlabels[<span style="color: #666666">0</span>])
        plt<span style="color: #666666">.</span>ylabel(axlabels[<span style="color: #666666">1</span>])
    plt<span style="color: #666666">.</span>legend(loc<span style="color: #666666">=0</span>)
</pre></div>
<p>
Our next step is to read the data on experimental binding energies and
reorganize them as functions of the mass number \( A \), the number of
protons \( Z \) and neutrons \( N \) using <b>pandas</b>.  Before we do this it is
always useful (unless you have a binary file or other types of compressed
data) to actually open the file and simply take a look at it!

<p>
In particular, the program that outputs the final nuclear masses is written in Fortran with a specific format. It means that we need to figure out the format and which columns contain the data we are interested in. Pandas comes with a function that reads formatted output. After having admired the file, we are now ready to start massaging it with <b>pandas</b>. The file begins with some basic format information.
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;                                                                                                                         </span>
<span style="color: #BA2121; font-style: italic">This is taken from the data file of the mass 2016 evaluation.                                                               </span>
<span style="color: #BA2121; font-style: italic">All files are 3436 lines long with 124 character per line.                                                                  </span>
<span style="color: #BA2121; font-style: italic">       Headers are 39 lines long.                                                                                           </span>
<span style="color: #BA2121; font-style: italic">   col 1     :  Fortran character control: 1 = page feed  0 = line feed                                                     </span>
<span style="color: #BA2121; font-style: italic">   format    :  a1,i3,i5,i5,i5,1x,a3,a4,1x,f13.5,f11.5,f11.3,f9.3,1x,a2,f11.3,f9.3,1x,i3,1x,f12.5,f11.5                     </span>
<span style="color: #BA2121; font-style: italic">   These formats are reflected in the pandas widths variable below, see the statement                                       </span>
<span style="color: #BA2121; font-style: italic">   widths=(1,3,5,5,5,1,3,4,1,13,11,11,9,1,2,11,9,1,3,1,12,11,1),                                                            </span>
<span style="color: #BA2121; font-style: italic">   Pandas has also a variable header, with length 39 in this case.                                                          </span>
<span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
</pre></div>
<p>
The data we are interested in are in columns 2, 3, 4 and 11, giving us
the number of neutrons, protons, mass numbers and binding energies,
respectively. We add also for the sake of completeness the element name. The data are in fixed-width formatted lines and we will
covert them into the <b>pandas</b> DataFrame structure.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Read the experimental data with Pandas</span>
Masses <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_fwf(infile, usecols<span style="color: #666666">=</span>(<span style="color: #666666">2</span>,<span style="color: #666666">3</span>,<span style="color: #666666">4</span>,<span style="color: #666666">6</span>,<span style="color: #666666">11</span>),
              names<span style="color: #666666">=</span>(<span style="color: #BA2121">&#39;N&#39;</span>, <span style="color: #BA2121">&#39;Z&#39;</span>, <span style="color: #BA2121">&#39;A&#39;</span>, <span style="color: #BA2121">&#39;Element&#39;</span>, <span style="color: #BA2121">&#39;Ebinding&#39;</span>),
              widths<span style="color: #666666">=</span>(<span style="color: #666666">1</span>,<span style="color: #666666">3</span>,<span style="color: #666666">5</span>,<span style="color: #666666">5</span>,<span style="color: #666666">5</span>,<span style="color: #666666">1</span>,<span style="color: #666666">3</span>,<span style="color: #666666">4</span>,<span style="color: #666666">1</span>,<span style="color: #666666">13</span>,<span style="color: #666666">11</span>,<span style="color: #666666">11</span>,<span style="color: #666666">9</span>,<span style="color: #666666">1</span>,<span style="color: #666666">2</span>,<span style="color: #666666">11</span>,<span style="color: #666666">9</span>,<span style="color: #666666">1</span>,<span style="color: #666666">3</span>,<span style="color: #666666">1</span>,<span style="color: #666666">12</span>,<span style="color: #666666">11</span>,<span style="color: #666666">1</span>),
              header<span style="color: #666666">=39</span>,
              index_col<span style="color: #666666">=</span><span style="color: #008000">False</span>)

<span style="color: #408080; font-style: italic"># Extrapolated values are indicated by &#39;#&#39; in place of the decimal place, so</span>
<span style="color: #408080; font-style: italic"># the Ebinding column won&#39;t be numeric. Coerce to float and drop these entries.</span>
Masses[<span style="color: #BA2121">&#39;Ebinding&#39;</span>] <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>to_numeric(Masses[<span style="color: #BA2121">&#39;Ebinding&#39;</span>], errors<span style="color: #666666">=</span><span style="color: #BA2121">&#39;coerce&#39;</span>)
Masses <span style="color: #666666">=</span> Masses<span style="color: #666666">.</span>dropna()
<span style="color: #408080; font-style: italic"># Convert from keV to MeV.</span>
Masses[<span style="color: #BA2121">&#39;Ebinding&#39;</span>] <span style="color: #666666">/=</span> <span style="color: #666666">1000</span>

<span style="color: #408080; font-style: italic"># Group the DataFrame by nucleon number, A.</span>
Masses <span style="color: #666666">=</span> Masses<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;A&#39;</span>)
<span style="color: #408080; font-style: italic"># Find the rows of the grouped DataFrame with the maximum binding energy.</span>
Masses <span style="color: #666666">=</span> Masses<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> t: t[t<span style="color: #666666">.</span>Ebinding<span style="color: #666666">==</span>t<span style="color: #666666">.</span>Ebinding<span style="color: #666666">.</span>max()])
</pre></div>
<p>
We have now read in the data, grouped them according to the variables we are interested in. 
We see how easy it is to reorganize the data using <b>pandas</b>. If we
were to do these operations in C/C++ or Fortran, we would have had to
write various functions/subroutines which perform the above
reorganizations for us.  Having reorganized the data, we can now start
to make some simple fits using both the functionalities in <b>numpy</b> and
<b>Scikit-Learn</b> afterwards.

<p>
Now we define five variables which contain
the number of nucleons \( A \), the number of protons \( Z \) and the number of neutrons \( N \), the element name and finally the energies themselves.
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>A <span style="color: #666666">=</span> Masses[<span style="color: #BA2121">&#39;A&#39;</span>]
Z <span style="color: #666666">=</span> Masses[<span style="color: #BA2121">&#39;Z&#39;</span>]
N <span style="color: #666666">=</span> Masses[<span style="color: #BA2121">&#39;N&#39;</span>]
Element <span style="color: #666666">=</span> Masses[<span style="color: #BA2121">&#39;Element&#39;</span>]
Energies <span style="color: #666666">=</span> Masses[<span style="color: #BA2121">&#39;Ebinding&#39;</span>]
<span style="color: #008000; font-weight: bold">print</span>(Masses)
</pre></div>
<p>
The next step, and we will define this mathematically later, is to set up the so-called <b>design matrix</b>. We will throughout call this matrix \( \boldsymbol{X} \).
It has dimensionality \( p\times n \), where \( n \) is the number of data points and \( p \) are the so-called predictors. In our case here they are given by the number of polynomials in \( A \) we wish to include in the fit. 
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Now we set up the design matrix X</span>
X <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros((<span style="color: #008000">len</span>(A),<span style="color: #666666">5</span>))
X[:,<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">1</span>
X[:,<span style="color: #666666">1</span>] <span style="color: #666666">=</span> A
X[:,<span style="color: #666666">2</span>] <span style="color: #666666">=</span> A<span style="color: #666666">**</span>(<span style="color: #666666">2.0/3.0</span>)
X[:,<span style="color: #666666">3</span>] <span style="color: #666666">=</span> A<span style="color: #666666">**</span>(<span style="color: #666666">-1.0/3.0</span>)
X[:,<span style="color: #666666">4</span>] <span style="color: #666666">=</span> A<span style="color: #666666">**</span>(<span style="color: #666666">-1.0</span>)
</pre></div>
<p>
With <b>scikitlearn</b> we are now ready to use linear regression and fit our data.
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>clf <span style="color: #666666">=</span> skl<span style="color: #666666">.</span>LinearRegression()<span style="color: #666666">.</span>fit(X, Energies)
fity <span style="color: #666666">=</span> clf<span style="color: #666666">.</span>predict(X)
</pre></div>
<p>
Pretty simple!  
Now we can print measures of how our fit is doing, the coefficients from the fits and plot the final fit together with our data.
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># The mean squared error                               </span>
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;Mean squared error: </span><span style="color: #BB6688; font-weight: bold">%.2f</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">%</span> mean_squared_error(Energies, fity))
<span style="color: #408080; font-style: italic"># Explained variance score: 1 is perfect prediction                                 </span>
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&#39;Variance score: </span><span style="color: #BB6688; font-weight: bold">%.2f</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> r2_score(Energies, fity))
<span style="color: #408080; font-style: italic"># Mean absolute error                                                           </span>
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&#39;Mean absolute error: </span><span style="color: #BB6688; font-weight: bold">%.2f</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> mean_absolute_error(Energies, fity))
<span style="color: #008000; font-weight: bold">print</span>(clf<span style="color: #666666">.</span>coef_, clf<span style="color: #666666">.</span>intercept_)

Masses[<span style="color: #BA2121">&#39;Eapprox&#39;</span>]  <span style="color: #666666">=</span> fity
<span style="color: #408080; font-style: italic"># Generate a plot comparing the experimental with the fitted values values.</span>
fig, ax <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>subplots()
ax<span style="color: #666666">.</span>set_xlabel(<span style="color: #BA2121">r&#39;$A = N + Z$&#39;</span>)
ax<span style="color: #666666">.</span>set_ylabel(<span style="color: #BA2121">r&#39;$E_\mathrm{bind}\,/\mathrm{MeV}$&#39;</span>)
ax<span style="color: #666666">.</span>plot(Masses[<span style="color: #BA2121">&#39;A&#39;</span>], Masses[<span style="color: #BA2121">&#39;Ebinding&#39;</span>], alpha<span style="color: #666666">=0.7</span>, lw<span style="color: #666666">=2</span>,
            label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Ame2016&#39;</span>)
ax<span style="color: #666666">.</span>plot(Masses[<span style="color: #BA2121">&#39;A&#39;</span>], Masses[<span style="color: #BA2121">&#39;Eapprox&#39;</span>], alpha<span style="color: #666666">=0.7</span>, lw<span style="color: #666666">=2</span>, c<span style="color: #666666">=</span><span style="color: #BA2121">&#39;m&#39;</span>,
            label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Fit&#39;</span>)
ax<span style="color: #666666">.</span>legend()
save_fig(<span style="color: #BA2121">&quot;Masses2016&quot;</span>)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pagination">
<li><a href="._chalmers-bs013.html">&laquo;</a></li>
  <li><a href="._chalmers-bs000.html">1</a></li>
  <li><a href="">...</a></li>
  <li><a href="._chalmers-bs006.html">7</a></li>
  <li><a href="._chalmers-bs007.html">8</a></li>
  <li><a href="._chalmers-bs008.html">9</a></li>
  <li><a href="._chalmers-bs009.html">10</a></li>
  <li><a href="._chalmers-bs010.html">11</a></li>
  <li><a href="._chalmers-bs011.html">12</a></li>
  <li><a href="._chalmers-bs012.html">13</a></li>
  <li><a href="._chalmers-bs013.html">14</a></li>
  <li class="active"><a href="._chalmers-bs014.html">15</a></li>
  <li><a href="._chalmers-bs015.html">16</a></li>
  <li><a href="._chalmers-bs016.html">17</a></li>
  <li><a href="._chalmers-bs017.html">18</a></li>
  <li><a href="._chalmers-bs018.html">19</a></li>
  <li><a href="._chalmers-bs019.html">20</a></li>
  <li><a href="._chalmers-bs020.html">21</a></li>
  <li><a href="._chalmers-bs021.html">22</a></li>
  <li><a href="._chalmers-bs022.html">23</a></li>
  <li><a href="._chalmers-bs023.html">24</a></li>
  <li><a href="">...</a></li>
  <li><a href="._chalmers-bs059.html">60</a></li>
  <li><a href="._chalmers-bs015.html">&raquo;</a></li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


<center style="font-size:80%">
<!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

